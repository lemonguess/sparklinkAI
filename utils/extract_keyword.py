import jieba.analyse
import logging
# -------------------
# 触发关键词表（可自行扩展）
# -------------------
TIME_TRIGGERS = [
    # 常见时间词
    "今天", "今日", "昨天", "明天", "刚刚", "最近", "近来", "刚才", "刚出",
    "现在", "此刻", "当前", "当下", "目前", "刚更新", "新发布", "新鲜",
    "今年", "今年内", "上个月", "本月", "上周", "本周", "近期", "近年",
    "最新", "实时", "即时", "刚刚发生", "突发",

    # 相对时间
    "刚发生", "刚出来", "刚推出", "刚上线", "刚公布", "刚曝光",
    "刚发布", "刚开盘", "刚上市", "刚下架", "刚出现", "刚完成",
    "即将", "马上", "立刻", "不久", "稍后",

    # 自然时间
    "上午", "中午", "下午", "傍晚", "晚上", "夜间", "凌晨",
    "今天早上", "今天下午", "今晚", "明早", "明晚", "昨晚",

    # 周期性
    "每天", "每日", "每周", "周末", "本季", "季度", "本年", "年内",
    "今年以来", "近十天", "近一周", "近一个月", "近三个月", "近半年"
]


DYNAMIC_TRIGGERS = [
    # 新闻/热点
    "新闻", "快讯", "热搜", "热度", "话题", "八卦", "趋势", "动态",
    "头条", "资讯", "报道", "媒体", "消息", "爆料", "舆论", "评论",

    # 金融/经济
    "行情", "股价", "汇率", "价格", "涨跌", "走势", "预测", "赛果",
    "基金", "期货", "比特币", "区块链", "加密货币", "大盘", "市值",
    "金融数据", "市场情况", "经济数据", "通胀", "失业率",

    # 天气/出行
    "天气", "预报", "路况", "限行", "气温", "降雨", "降雪", "台风", "地震",
    "暴雨", "高温", "寒潮", "空气质量", "雾霾", "灾害", "自然灾害",

    # 体育/赛事
    "赛果", "比分", "赛事", "冠军", "球赛", "比赛结果", "联赛", "排名",
    "战报", "赛程", "胜负", "积分榜", "世界杯", "奥运会",

    # 娱乐/社会
    "综艺", "电影票房", "演唱会", "上映", "下架", "热播", "收视率",
    "节目单", "演出", "直播", "首映", "粉丝数", "订阅量", "热度榜",

    # 科技/互联网
    "新机发布", "新品", "更新", "版本", "补丁", "下载量", "热榜",
    "开源", "维护公告", "宕机", "停机", "升级"
]


TRIGGER_WORDS = set(TIME_TRIGGERS + DYNAMIC_TRIGGERS)


def extract_keywords(text, topK=5):
    """
    使用 jieba 提取关键词
    """
    keywords = jieba.analyse.extract_tags(text, topK=topK)
    logging.info(keywords)
    return "+".join(keywords)


def need_web_search(text):
    """
    判断是否需要网络检索
    """
    for word in TRIGGER_WORDS:
        if word in text:
            return True
    return False


if __name__ == "__main__":
    examples = [
        "马斯克今天访问了上海",
        "爱因斯坦的出生地在哪",
        "最近的黄金价格是多少",
        "三国演义的作者是谁",
        "明天天气怎么样",
    ]

    for q in examples:
        print("=" * 40)
        print("用户输入：", q)
        keywords = extract_keywords(q)
        print("提取关键词：", keywords)
        print("是否需要网络检索：", need_web_search(q))
